<Window x:Name="AppMainWindow" x:Class="HHSAdvWin.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:HHSAdvWin"
        FocusManager.FocusedElement="{Binding ElementName=InputTextBox}"
        d:DataContext="{d:DesignInstance Type=local:MainWindowModel}"
 
        mc:Ignorable="d"
        Title="ハイハイスクールアドベンチャー" Height="{Binding WindowHeight}" Width="{Binding WindowWidth}" Closing="MainWindow_Closing"
        WindowStyle="None"
        AllowsTransparency="True" ResizeMode="CanResizeWithGrip" SizeChanged="AppMainWindow_SizeChanged">
    <!-- WindowChrome: OSへキャプション高さ等を通知 -->
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      CornerRadius="12"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <!-- タイトルバー -->
        <Border CornerRadius="12" Background="{DynamicResource TitleBarBackgroundBrush}"
               Height="32"
               VerticalAlignment="Top">
            <Grid Height="32" Background="{DynamicResource TitleBarBackgroundBrush}" x:Name="TitleBarGrid">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- アプリケーションアイコン -->
                <Image Width="16" Height="16" Margin="8,0"
                       Source="{Binding Icon, RelativeSource={RelativeSource AncestorType=Window}}"
                       VerticalAlignment="Center"/>

                <!-- タイトル -->
                <TextBlock Grid.Column="1"
               Text="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}"
               VerticalAlignment="Center"
               Foreground="{DynamicResource TitleBarForegroundBrush}"
               Margin="8,0"/>

                <!-- ボタン群 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="—" Width="40" Click="Minimize_Click"
                WindowChrome.IsHitTestVisibleInChrome="True"/>
                    <Button Content="□" Width="40" Click="Maximize_Click"
                WindowChrome.IsHitTestVisibleInChrome="True"/>
                    <Button Content="×" Width="40" Click="Close_Click"
                WindowChrome.IsHitTestVisibleInChrome="True"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- コンテンツ -->
        <Grid Margin="0,32,0,0" Background="{DynamicResource BackgroundBrush}">
            <Grid ClipToBounds="False">
                <Grid x:Name="MainContent">
                    <!-- 行の高さ定義 -->
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- メニュー -->
                        <RowDefinition Height="*"/>
                        <!-- ビットマップ領域 -->
                        <RowDefinition Height="Auto"/>
                        <!-- コマンド入力 -->
                        <RowDefinition Height="Auto"/>
                        <!-- Hit ANy Key -->
                        <RowDefinition Height="*"/>
                        <!-- ログ -->
                    </Grid.RowDefinitions>

                    <!-- メニューバー -->
                    <Menu Grid.Row="0" Background="{DynamicResource MenuBackgroundBrush}">
                        <MenuItem Header="_File" Style="{StaticResource TopLevelMenuItemStyle}">
                            <MenuItem Header="_Quit" Style="{StaticResource SubMenuItemStyle}" Click="Menu_Quit_Clicked"/>
                        </MenuItem>
                        <MenuItem Header="_Tools" Style="{StaticResource TopLevelMenuItemStyle}">
                            <MenuItem Header="Settings" Style="{StaticResource SubMenuItemStyle}" Click="Settings_Click"/>
                        </MenuItem>
                        <MenuItem Header="_Help" Style="{StaticResource TopLevelMenuItemStyle}">
                            <MenuItem Header="_About" Style="{StaticResource SubMenuItemStyle}" Click="Help_About_Click"/>
                        </MenuItem>
                    </Menu>

                    <!-- ビットマップ表示領域 -->
                    <Border Grid.Row="1"
                BorderBrush="Gray" BorderThickness="1" Background="Black">
                        <Image x:Name="BitmapArea" Width="NaN" MinHeight="240"/>
                    </Border>

                    <!-- コマンド入力（1行） -->
                    <TextBox x:Name="InputTextBox" Grid.Row="2" Height="24" Margin="2"
                VerticalContentAlignment="Center"
                local:Placeholder.Text="どうする?"
                local:Placeholder.Foreground="LightGray"
                local:Placeholder.FontFamily="Yu Gothic UI"
                local:Placeholder.Margin="8,4,0,0"
                AcceptsReturn="False" KeyDown="InputTextBox_KeyDown" />

                    <TextBox x:Name="HitAnyKey" Grid.Row="3" TextWrapping="Wrap" Text="何かキーを押してください" Height="24" FontSize="14" HorizontalAlignment="Stretch" Foreground="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" Background="Black" Focusable="False" IsReadOnly="True" HorizontalContentAlignment="Center"/>

                    <!-- ログ表示（スクロール対応） -->
                    <ScrollViewer x:Name="ScrollArea" Grid.Row="4" VerticalScrollBarVisibility="Auto">
                        <TextBox x:Name="LogArea"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 IsReadOnly="True"
                                 BorderThickness="0"
                                 FontSize="{Binding FontSize, Mode=TwoWay}"
                                 VerticalScrollBarVisibility="Auto"/>
                    </ScrollViewer>
                </Grid>
                <!-- オーバーレイ -->
                <Grid x:Name="Overlay"
                      Background="Black"
                      Opacity="0.8"
                      ClipToBounds="False"
                      Visibility="Collapsed">
                    <Grid.Clip>
                        <!-- Y=32 から下だけ描画 -->
                        <RectangleGeometry x:Name="RollRect" Rect="0,0,320,450"/>
                    </Grid.Clip>

                    <Canvas>
                        <Image x:Name="CreditsImage"
                               Stretch="None"
                               SnapsToDevicePixels="True"
                               UseLayoutRounding="True"
                               VerticalAlignment="Top">
                                <Image.RenderTransform>
                                    <TranslateTransform x:Name="CreditsTransform"/>
                                </Image.RenderTransform>
                            </Image>
                    </Canvas>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Window>
